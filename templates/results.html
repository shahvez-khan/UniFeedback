<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Faculty Feedback System | Results</title>
  <!-- Load Tailwind CSS CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Custom configuration for Inter font and colors -->
  <script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                },
                colors: {
                    primary: '#0d9488', // Teal 600 (Professional, calm blue-green)
                    secondary: '#f0fdfa', // Light Gray-Green (Very light background)
                    accent: '#f97316', // Orange 600 (Energetic accent)
                }
            }
        }
    }
  </script>
  <style>
    /* Ensures smooth scrolling and Inter font is applied */
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f8fafc; /* Slate 50 */
    }
  </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Header / Navigation Bar (Mobile-Optimized) -->
    <header class="bg-white shadow-md sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <a href="{{ url_for('home') }}" class="text-2xl font-bold text-primary">
                <span class="text-accent">Uni</span>Feedback
            </a>
            
            <!-- Grouped Header Items (Nav and Button) -->
            <nav class="hidden md:flex space-x-6 items-center">
                <a href="{{ url_for('home') }}" class="text-gray-600 hover:text-primary transition duration-150 font-medium">Home</a>
                <a href="{{ url_for('feedback') }}" class="text-gray-600 hover:text-primary transition duration-150 font-medium">Give Feedback</a>
                <a href="{{ url_for('results') }}" class="text-gray-600 hover:text-primary transition duration-150 font-medium">View Results</a>
                <a href="{{ url_for('feedback') }}" class="bg-primary hover:bg-[#0f766e] text-white font-semibold py-2 px-4 rounded-lg shadow-lg transition duration-150 transform hover:scale-105">
                    Start Feedback
                </a>
            </nav>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden text-gray-600 hover:text-primary p-2 rounded-lg transition duration-150">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
    </header>

    <!-- Mobile Menu Drawer -->
    <div id="mobile-menu" class="hidden md:hidden fixed inset-0 bg-white z-30 transition-transform duration-300 transform translate-x-full">
        <div class="p-4 border-b flex justify-between items-center shadow-sm">
            <div class="text-2xl font-bold text-primary"><span class="text-accent">Uni</span>Feedback</div>
            <button id="close-menu-btn" class="text-gray-600 hover:text-primary p-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <nav class="flex flex-col space-y-2 p-4">
            <a href="{{ url_for('home') }}" class="py-3 px-4 text-lg font-medium text-gray-800 hover:bg-gray-100 rounded-md transition duration-150">Home</a>
            <a href="{{ url_for('feedback') }}" class="py-3 px-4 text-lg font-medium text-gray-800 hover:bg-gray-100 rounded-md transition duration-150">Give Feedback</a>
            <a href="{{ url_for('results') }}" class="py-3 px-4 text-lg font-medium text-gray-800 hover:bg-gray-100 rounded-md transition duration-150">View Results</a>
            <a href="{{ url_for('feedback') }}" class="mt-4 bg-primary hover:bg-[#0f766e] text-white font-semibold py-3 px-4 rounded-lg shadow-lg transition duration-150 text-center">Start Feedback</a>
        </nav>
    </div>

    <main class="flex-grow">
        <div class="max-w-4xl mx-auto mt-8 md:mt-12 mb-12 p-6 sm:p-8 bg-white rounded-xl shadow-2xl border border-gray-100">
            <h1 class="text-3xl font-bold text-gray-900 mb-6 text-center">Feedback Results Dashboard</h1>

            <!-- Faculty Selection Form -->
            <form method="GET" action="{{ url_for('results') }}" class="mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
                <label for="faculty-select" class="block text-sm font-semibold text-gray-700 mb-2">Select Faculty to View Results:</label>
                <select name="faculty" id="faculty-select" onchange="this.form.submit()" 
                        class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary transition duration-150">
                    <option value="">-- Select Faculty --</option>
                    {% for f in faculties %}
                        <option value="{{ f }}" {% if selected_faculty==f %}selected{% endif %}>{{ f }}</option>
                    {% endfor %}
                </select>
            </form>

            {% if summary %}
                <div class="border-t border-gray-200 pt-6">
                    <h2 class="text-2xl font-bold text-primary mb-4">Summary for {{ selected_faculty }}</h2>
                    
                    <!-- Key Metrics -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                        <div class="p-4 bg-secondary rounded-lg border-l-4 border-primary shadow-md">
                            <p class="text-sm font-medium text-gray-600">Total Responses</p>
                            <p class="text-3xl font-extrabold text-gray-900">{{ summary.response_count }}</p>
                        </div>
                        <div class="p-4 bg-secondary rounded-lg border-l-4 border-accent shadow-md">
                            <p class="text-sm font-medium text-gray-600">Overall Average Rating</p>
                            <p class="text-3xl font-extrabold text-gray-900">{{ "%.2f"|format(summary.overall_average) }} / 5.00</p>
                        </div>
                    </div>

                    <!-- Category Averages -->
                    <h3 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2">Category Averages (Out of 5)</h3>
                    <ul class="space-y-3 mb-8"> 
                        {% for cat, avg in summary.averages.items() %}
                            <li class="flex justify-between items-center p-3 bg-white rounded-lg border shadow-sm">
                                <span class="font-medium text-gray-700">{{ cat }}</span>
                                <span class="font-semibold text-lg text-primary">{{ avg }} / 5</span>
                            </li>
                        {% endfor %}
                    </ul>
                    
                    <!-- Comments Section -->
                    <h3 class="text-xl font-bold text-gray-800 mb-3 border-b pb-2">Student Comments</h3>
                    {% if summary.comments %}
                        <ul class="space-y-4 comments-list"> 
                            {% for com in summary.comments %}
                                <li class="p-4 bg-gray-50 rounded-lg border border-gray-100 text-gray-700 leading-relaxed">
                                    <span class="font-bold text-primary mr-2">â€¢</span> {{ com }}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-gray-500 italic p-4 bg-gray-50 rounded-lg">No written comments have been submitted for this faculty member yet.</p>
                    {% endif %}

                    <!-- Download Button -->
                    <a href="{{ url_for('report_pdf', faculty=selected_faculty) }}" 
                       class="mt-8 inline-block w-full text-center bg-accent hover:bg-[#c2410a] text-white font-bold py-3 px-6 rounded-lg shadow-xl transition duration-300 transform hover:scale-[1.01]">
                        Download Professional PDF Report
                    </a>
                </div>

            {% elif selected_faculty %}
                <div class="text-center mt-10 p-10 bg-secondary rounded-xl border border-primary/20">
                    <p class="text-xl text-gray-700 font-semibold">No feedback available for <strong>{{ selected_faculty }}</strong> yet.</p>
                    <p class="text-gray-500 mt-2">Be the first to submit a review!</p>
                </div>
            {% else %}
                <div class="text-center mt-10 p-10 bg-secondary rounded-xl border border-primary/20">
                    <p class="text-xl text-gray-700 font-semibold">Please select a faculty member from the dropdown above to view their performance summary.</p>
                    <a href="{{ url_for('feedback') }}" class="text-primary hover:underline mt-4 inline-block">Go to Feedback Form</a>
                </div>
            {% endif %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-auto py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm">
            &copy; 2025 UniFeedback System. All rights reserved. | <a href="#" class="text-primary hover:text-accent">Privacy Policy</a>
        </div>
    </footer>

    <!-- JavaScript for Mobile Menu Toggle -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuBtn = document.getElementById('mobile-menu-btn');
            const closeBtn = document.getElementById('close-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');

            const openMenu = () => {
                mobileMenu.classList.remove('hidden', 'translate-x-full');
                mobileMenu.classList.add('translate-x-0');
            };

            const closeMenu = () => {
                mobileMenu.classList.remove('translate-x-0');
                mobileMenu.classList.add('translate-x-full');
                setTimeout(() => {
                    mobileMenu.classList.add('hidden');
                }, 300);
            };

            menuBtn.addEventListener('click', openMenu);
            closeBtn.addEventListener('click', closeMenu);

            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', closeMenu);
            });
        });
    </script>
</body>
</html>
